<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Password Helper</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîí</text></svg>">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root{
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      --bg:#f3f4f6;
      --card:#ffffff;
      --accent:#2563eb;
      --accent-soft:rgba(37,99,235,0.08);
      --border:#e5e7eb;
      --text:#111827;
      --muted:#6b7280;
      --shadow:0 14px 32px rgba(15,23,42,0.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100dvh;display:flex;align-items:center;justify-content:center;
      background:radial-gradient(circle at top,#e5e7eb 0,#f9fafb 40%,#ffffff 100%);
      color:var(--text);padding:24px;
    }

    .wrap{
      width:100%;max-width:560px;background:var(--card);padding:22px;border-radius:18px;
      box-shadow:var(--shadow);border:1px solid var(--border);
    }
    .title{
      display:flex;align-items:center;gap:14px;margin:0 0 12px;
      font-weight:700;font-size:1.6rem;
    }
    .logo{
      font-size:1.9rem;
      line-height:1;
      display:inline-block;
    }
    .subtitle{margin:0 0 18px;color:var(--muted);font-size:1.05rem}

    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px}
    .btn{
      border:1px solid var(--border);padding:12px 18px;border-radius:999px;background:#f9fafb;color:var(--text);
      cursor:pointer;font-size:1.02rem;display:inline-flex;align-items:center;gap:10px;font-weight:600;
      transition:transform .12s ease,box-shadow .12s ease,background .12s ease
    }
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 8px 18px rgba(37,99,235,.25)}
    .btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(15,23,42,.08);background:#eff6ff}
    #btnSimple:hover{color:#111;background:#dbeafe}

    .password-label{font-size:.82rem;color:var(--accent);text-transform:uppercase;letter-spacing:.15em;margin-bottom:8px}
    .password-box{display:flex;align-items:center;justify-content:space-between;gap:14px;
      padding:14px;border-radius:16px;background:#f9fafb;border:1px solid var(--border)}
    .password-output{
      font-family:"SF Mono",Menlo,Consolas,monospace;font-size:1.2rem;color:var(--text);
      cursor:pointer;user-select:none;padding:6px 8px;border-radius:8px;display:inline-block;max-width:100%;
      white-space:nowrap;overflow-x:auto;transition:background .15s ease;
    }
    .password-output:hover{background:var(--accent-soft)}
    .copy-btn{border:none;border-radius:999px;padding:10px 14px;background:var(--accent-soft);color:var(--accent);cursor:pointer;display:inline-flex;align-items:center;gap:8px;justify-content:center;font-size:1.05rem}

    /* Modal */
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:60}
    .modal{background:var(--card);padding:18px;border-radius:12px;max-width:640px;width:92%;
      box-shadow:0 18px 40px rgba(0,0,0,.35);border:1px solid var(--border);animation:fadeIn .25s ease}
    @keyframes fadeIn {from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
    .modal h3{margin:0 0 8px;font-size:1rem}
    .code{
      font-family:Consolas,"Courier New",monospace;
      background:#ffffff;
      color:#111;
      padding:12px;border-radius:8px;
      border:1px solid var(--border);
      overflow:auto;font-size:0.95rem;
    }
    .modal .m-controls{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .modal .m-btn{
      padding:8px 12px;border-radius:8px;border:1px solid var(--border);
      background:#f9fafb;cursor:pointer;font-size:0.9rem;
      display:inline-flex;align-items:center;gap:6px;
      transition:transform .15s ease,background .15s ease,box-shadow .15s ease;
    }
    .modal .m-btn i{font-size:1rem;}
    .modal .m-btn:hover{transform:translateY(-1px);background:#e0e7ff}
    .modal .m-btn:active{animation:pulse .25s ease}
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .modal .m-btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .modal .m-btn.primary:hover{background:#1e40af}
    .modal .m-btn.danger{background:#fee2e2;color:#991b1b;border-color:#fecdd3}
    .modal .m-btn.danger:hover{background:#fecdd3}

    .hidden{display:none !important;}

    .confirm{
      margin-top:10px;
      padding:12px;
      border:1px dashed var(--border);
      border-radius:10px;
      background:var(--accent-soft);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      color:var(--text);
    }
    .confirm strong{display:block;margin-bottom:4px;}
    .confirm-actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;}

    .history-list{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:8px;
      max-height:320px;
      overflow:auto;
    }
    .history-list li{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:10px;
      border:1px solid var(--border);
      border-radius:10px;
      background:#f9fafb;
      font-family:"SF Mono",Menlo,Consolas,monospace;
      font-size:0.92rem;
    }
    .history-list li span{white-space:nowrap;}
    .history-list .pwd{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%;}
    .history-list .time{color:var(--muted);font-size:0.85rem;text-align:right;}
    .history-list .empty{font-family:inherit;font-style:italic;justify-content:center;color:var(--muted);}

    @media (max-width:720px){
      body{
        padding:0;
        align-items:stretch;
        min-height:100dvh;
        overflow-y:hidden;
      }
      .wrap{
        padding:24px 18px 32px;
        border-radius:0;
        min-height:100dvh;
        max-width:none;
      }
      .title{font-size:1.45rem;gap:10px;flex-wrap:wrap;}
      .subtitle{font-size:1.05rem;}
      .controls{
        flex-direction:column;
      }
      .btn{
        width:100%;
        justify-content:center;
        font-size:1.1rem;
        padding:14px 20px;
      }
      .password-box{
        flex-direction:column;
        align-items:flex-start;
      }
      .password-output{
        width:100%;
        white-space:normal;
        overflow-wrap:break-word;
        word-break:break-word;
        font-size:1.15rem;
      }
      .copy-btn{
        width:100%;
      }
      .history-list li{
        flex-direction:column;
        align-items:flex-start;
        gap:4px;
      }
      .history-list .pwd{
        max-width:100%;
        white-space:normal;
      }
      .history-list .time{
        text-align:left;
      }
      .modal{
        width:96%;
        max-height:90vh;
        overflow:auto;
      }
      .modal .m-controls{
        flex-direction:column;
        align-items:stretch;
      }
      .modal .m-btn{
        justify-content:center;
      }
    }
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <div class="title"><span class="logo">üîí</span>Password Helper</div>
    <p class="subtitle">Generate simple or strong, easy-to-remember passwords.</p>

    <div class="controls">
      <button id="btnSimple" class="btn primary">üôÇ Simple</button>
      <button id="btnStrong" class="btn">üõ°Ô∏è Strong</button>
      <button id="btnApi" class="btn"><i class="fa-solid fa-link"></i> API</button>
      <button id="btnHistory" class="btn"><i class="fa-solid fa-clock-rotate-left"></i> History</button>
    </div>

    <div class="password-label" id="passwordLabel">Simple password</div>
    <div class="password-box">
      <div id="passwordOutput" class="password-output" title="Click to copy"></div>
      <button id="copyBtn" class="copy-btn"><i class="fa-regular fa-copy"></i></button>
    </div>
  </div>

  <!-- API modal -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="apiTitle">
      <h3 id="apiTitle">PowerShell example</h3>
      <div class="code" id="apiCode" tabindex="0">
$Password = Invoke-RestMethod -Uri https://password.danieltesting.space/simple
      </div>
      <div class="m-controls">
        <button id="copyApi" class="m-btn"><i class="fa-regular fa-copy"></i> Copy</button>
        <button id="closeApi" class="m-btn primary"><i class="fa-solid fa-xmark"></i> Close</button>
      </div>
    </div>
  </div>

  <!-- History modal -->
  <div id="historyOverlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="historyTitle">
      <h3 id="historyTitle">Copied password history</h3>
      <ul id="historyList" class="history-list" aria-live="polite"></ul>
      <div id="clearConfirm" class="confirm hidden" role="alert" aria-live="assertive">
        <div>
          <strong>Are you sure?</strong>
          <span>This will remove your copied password history from this device.</span>
        </div>
        <div class="confirm-actions">
          <button id="confirmClear" class="m-btn danger"><i class="fa-solid fa-trash"></i> Yes, clear it</button>
          <button id="cancelClear" class="m-btn"><i class="fa-solid fa-rotate-left"></i> Keep history</button>
        </div>
      </div>
      <div class="m-controls">
        <button id="clearHistory" class="m-btn"><i class="fa-solid fa-trash"></i> Clear</button>
        <button id="closeHistory" class="m-btn primary"><i class="fa-solid fa-xmark"></i> Close</button>
      </div>
    </div>
  </div>

  <script>
    const out = document.getElementById('passwordOutput');
    const copyBtn = document.getElementById('copyBtn');
    const overlay = document.getElementById('overlay');
    const apiCode = document.getElementById('apiCode');
    const copyApi = document.getElementById('copyApi');
    const closeApi = document.getElementById('closeApi');
    const historyOverlay = document.getElementById('historyOverlay');
    const historyList = document.getElementById('historyList');
    const closeHistory = document.getElementById('closeHistory');
    const clearHistory = document.getElementById('clearHistory');
    const clearConfirm = document.getElementById('clearConfirm');
    const confirmClear = document.getElementById('confirmClear');
    const cancelClear = document.getElementById('cancelClear');

    const HISTORY_KEY = 'pwdCopyHistory';
    const HISTORY_LIMIT = 50;
    const nzFormatter = new Intl.DateTimeFormat('en-NZ', {
      dateStyle: 'medium',
      timeStyle: 'short',
      timeZone: 'Pacific/Auckland'
    });

    function readHistory(){
      try{
        const saved = localStorage.getItem(HISTORY_KEY);
        return saved ? JSON.parse(saved) : [];
      }catch{
        return [];
      }
    }

    function writeHistory(history){
      try{
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history.slice(0, HISTORY_LIMIT)));
      }catch{}
    }

    function recordHistory(password){
      if(!password || password.trim()==='') return;
      const history = readHistory();
      history.unshift({pwd: password, ts: Date.now()});
      writeHistory(history);
    }

    function formatTimestamp(ts){
      return nzFormatter.format(new Date(ts));
    }

    function renderHistory(){
      const history = readHistory();
      historyList.innerHTML = '';
      if(!history.length){
        const empty = document.createElement('li');
        empty.className = 'empty';
        empty.textContent = 'No copied passwords yet.';
        historyList.appendChild(empty);
        return;
      }
      history.forEach(entry => {
        const li = document.createElement('li');
        const pwd = document.createElement('span');
        pwd.className = 'pwd';
        pwd.textContent = entry.pwd;
        const time = document.createElement('span');
        time.className = 'time';
        time.textContent = formatTimestamp(entry.ts);
        li.appendChild(pwd);
        li.appendChild(time);
        historyList.appendChild(li);
      });
    }

    function openOverlay(el){
      el.style.display='flex';
      el.setAttribute('aria-hidden','false');
    }

    function closeOverlay(el){
      el.style.display='none';
      el.setAttribute('aria-hidden','true');
    }

    async function fetchPassword(type){
      try{
        const r = await fetch('/'+type,{cache:'no-store'});
        if(!r.ok) throw new Error();
        return await r.text();
      }catch{return 'Error';}
    }
    async function showPassword(type){
      out.textContent='‚Ä¶';
      const pwd=await fetchPassword(type);
      out.textContent=pwd;
      document.getElementById('passwordLabel').textContent=type==='strong'?'Strong password':'Simple password';
    }
    async function copyText(text){
      if(!text) return;
      try{
        await navigator.clipboard.writeText(text);
        recordHistory(text);
        copyBtn.innerHTML='<i class="fa-solid fa-check"></i>';
        setTimeout(()=>copyBtn.innerHTML='<i class="fa-regular fa-copy"></i>',900);
      }catch{
        copyBtn.innerHTML='<i class="fa-solid fa-xmark"></i>';
        setTimeout(()=>copyBtn.innerHTML='<i class="fa-regular fa-copy"></i>',900);
      }
    }

    out.addEventListener('click',()=>copyText(out.textContent));
    copyBtn.addEventListener('click',()=>copyText(out.textContent));
    document.getElementById('btnSimple').onclick=()=>showPassword('simple');
    document.getElementById('btnStrong').onclick=()=>showPassword('strong');
    document.getElementById('btnApi').onclick=()=>{
      openOverlay(overlay);
      apiCode.focus();
    };
    closeApi.onclick=()=>closeOverlay(overlay);
    document.getElementById('btnHistory').onclick=()=>{
      renderHistory();
      clearConfirm.classList.add('hidden');
      openOverlay(historyOverlay);
    };
    closeHistory.onclick=()=>{
      closeOverlay(historyOverlay);
      clearConfirm.classList.add('hidden');
    };
    clearHistory.onclick=()=>{
      clearConfirm.classList.remove('hidden');
      confirmClear.focus();
    };
    cancelClear.onclick=()=>{
      clearConfirm.classList.add('hidden');
      clearHistory.focus();
    };
    confirmClear.onclick=()=>{
      writeHistory([]);
      renderHistory();
      clearConfirm.classList.add('hidden');
      clearHistory.focus();
    };
    copyApi.onclick=async()=>{
      const text=apiCode.textContent.trim();
      try{
        await navigator.clipboard.writeText(text);
        copyApi.innerHTML='<i class="fa-solid fa-check"></i> Copied';
        setTimeout(()=>copyApi.innerHTML='<i class="fa-regular fa-copy"></i> Copy',900);
      }catch{
        copyApi.innerHTML='<i class="fa-solid fa-xmark"></i> Error';
        setTimeout(()=>copyApi.innerHTML='<i class="fa-regular fa-copy"></i> Copy',900);
      }
    };
    overlay.addEventListener('click',e=>{
      if(e.target===overlay){closeOverlay(overlay);}
    });
    historyOverlay.addEventListener('click',e=>{
      if(e.target===historyOverlay){closeOverlay(historyOverlay);}
    });
    document.addEventListener('keydown',e=>{
      if(e.key==='Escape'){
        if(overlay.style.display==='flex') closeOverlay(overlay);
        if(historyOverlay.style.display==='flex') closeOverlay(historyOverlay);
      }
    });

    showPassword('simple');
  </script>
</body>
</html>
